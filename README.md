# Sigma-Image-Tokenizer

## Альтернативные методы токенизации изображений для Transformer-моделей
FFT-токенизация (низкочастотная фильтрация + pixel unshuffle),
SVD-токенизация (генерация признаков с помощью SVD разложения и оценкой значимости токенов по сингулярным значениям) и
mSVD-токенизация (генерация тензоров U и V SVD разложения с помощью нейронных сетей и оценка признаков с помощью функции оценки) со статическим и динамическим выбором токенов.

## Описание методов

* FFT-токенизатор: низкочастотный квадратный фильтр в спектре (центрирование + лог-масштаб),
свёрточная извлечение признаков и последовательное применение PixelUnshuffle для получения набора токенов без потери информации и локальных связей.
Длина последовательности масштабируется как (s/16)^2, где s -- размер фильтра. Размер фильтра может быть задан как гиперпараметр, а может определяться динамически.

* SVD-токенизатор: с помощью SVD разложения каждое изображение преобразуется в матрицы U, V и вектор сингулярных чисел.
По сингулярным значениям отбираются k векторов из матриц U и V. Позволяет многократно сократить длину входной последовательности с небольшой потерей качества,
однако узким местом скорости работы является SVD разложение.

* mSVD-токенизатор: тензоры U и V получаются с помощью последовательного извлечения признаков свёрточными сетями и применением PixelUnshuffle.
Сингулярные значения заменяются оценками, полученными с помощью функции оценки токенов. mSVD позволяет сократить длину входной последовательности в два раза,
улучшив при этом качество модели.

Таблица длин последовательности и метрик:

| Метод токенизации | Точность | F1-метрика | Средняя длина входной последовательности |
|---|---:|---:|---:|
| Vision Transformer | 0.79 | 0.79 | 257 |
| mSVD | 0.85 | 0.85 | 257 |
| mSVD (k=1)   | 0.43 | 0.40 | 2 |
| mSVD (k=4)   | 0.52 | 0.48 | 5 |
| mSVD (k=16)  | 0.61 | 0.57 | 17 |
| mSVD (k=32)  | 0.66 | 0.63 | 33 |
| mSVD (k=64)  | 0.71 | 0.70 | 65 |
| mSVD (k=96)  | 0.76 | 0.75 | 97 |
| mSVD (k=128) | 0.80 | 0.80 | 129 |
| mSVD (k=160) | 0.83 | 0.83 | 161 |
| mSVD (k=192) | 0.85 | 0.85 | 193 |
| mSVD (k=224) | 0.85 | 0.85 | 225 |
| mSVD (p=0.100) | 0.62 | 0.58 | 23.1 |
| mSVD (p=0.200) | 0.67 | 0.64 | 46.6 |
| mSVD (p=0.300) | 0.71 | 0.69 | 70.0 |
| mSVD (p=0.400) | 0.74 | 0.73 | 90.4 |
| mSVD (p=0.500) | 0.77 | 0.77 | 120.2 |
| mSVD (p=0.600) | 0.81 | 0.81 | 149.4 |
| mSVD (p=0.700) | 0.83 | 0.83 | 166.0 |
| mSVD (p=0.800) | 0.85 | 0.85 | 192.5 |
| mSVD (p=0.900) | 0.85 | 0.85 | 228.9 |
| mSVD (p=0.950) | 0.85 | 0.85 | 242.2 |
| mSVD (p=0.990) | 0.85 | 0.85 | 253.6 |



## Сравнение методов

| Метод токенизации      | Точность | F1-метрика | Средняя длина входной последовательности |
|------------------------|---------:|-----------:|-----------------------------------------:|
| Vision Transformer     |    0.79  |      0.79  |                                    257   |
| FFT-токенизатор        |    0.79  |      0.79  |                                    257   |
| SVD-токенизатор        |    0.69  |      0.69  |                                     15.3 |
| mSVD                   |    0.85  |      0.85  |                                    192.5 |

